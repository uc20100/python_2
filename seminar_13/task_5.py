# Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ â„–5
# ðŸ“Œ Ð”Ð¾Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ð¸ 3 Ð¸ 4. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÐºÐ»Ð°ÑÑ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹
# Ð¸Ð¼ÐµÐµÑ‚ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹:
# ðŸ“Œ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¸Ð· Ð·Ð°Ð´Ð°Ð½Ð¸Ñ 4)
# ðŸ“Œ Ð²Ñ…Ð¾Ð´ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ - Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð¼Ñ Ð¸ id Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ. Ð”Ð»Ñ
# Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ
# Ð¼Ð°Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð½Ð° Ñ€Ð°Ð²ÐµÐ½ÑÑ‚Ð²Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.
# Ð•ÑÐ»Ð¸ Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð½ÐµÑ‚, Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
# Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°. Ð ÐµÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÐµÑÑ‚ÑŒ, Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ ÐµÐ³Ð¾ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¸Ð·
# Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.
# ðŸ“Œ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ. Ð•ÑÐ»Ð¸ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
# Ð¼ÐµÐ½ÑŒÑˆÐµ, Ñ‡ÐµÐ¼ Ð²Ð°Ñˆ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ, Ð²Ñ‹Ð·Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ
# Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°.

import json
from task_4 import Us
from task_3 import AccessException
from task_3 import LevelException


class User:
    """
    ÐšÐ»Ð°ÑÑ 'ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ'

     ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹:
    - self.set_user (set): Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾ Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ð¼Ð¸ ÐºÐ»Ð°ÑÑÐ° Us,

     ÐœÐµÑ‚Ð¾Ð´Ñ‹:
    - load(self, file_json: str = 'users.json'): Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ Ð² Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ ÐºÐ»Ð°ÑÑÐ° Us Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð° JSON,
    - login_system(self, name, identifier): ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ðµ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°, Ð»Ð¸Ð±Ð¾ Ð¾ÑˆÐ¸Ð±ÐºÑƒ AccessException,
    - add_user(self, name, identifier, level): Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, ÐµÑÐ»Ð¸ Ñ‚Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÐµÑÑ‚ÑŒ Ð¸ Ð½Ð¾Ð²Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð¼ÐµÐ½ÑŒÑˆÐµ Ñ‡ÐµÐ¼ Ð±Ñ‹Ð», Ñ‚Ð¾ Ð²Ñ‹Ð´Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ LevelException,

     Dunder Ð¼ÐµÑ‚Ð¾Ð´Ñ‹:
    - __str__(self): Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ð¾Ðµ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð°.
    """
    def __init__(self):
        self.set_user = None

    def __str__(self):
        """
        Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ð¾Ðµ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð°.

        :return:
        """
        ret = ''
        for item in self.set_user:
            ret += f'id: {item.identifier}, name: {item.name}, level: {item.level}\n'
        return ret

    def load(self, file_json: str = 'users.json'):
        """
        Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ Ð² Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾, Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ ÐºÐ»Ð°ÑÑÐ° Us Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð° JSON.

        :param file_json: Ñ„Ð°Ð¹Ð» JSON.
        :return:
        """
        list_users = []
        try:
            with open(file_json, 'r', encoding='utf-8') as fj:
                try:
                    json_dict = json.load(fj)
                except json.decoder.JSONDecodeError as e:
                    raise e
        except FileNotFoundError as e:
            raise FileNotFoundError(f"Ð¤Ð°Ð¹Ð»Ð° '{file_json}' Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾. {e}")
        for lev, item_ in json_dict.items():
            for ident, name in item_.items():
                a = Us(name, ident, lev)
                list_users.append(a)
        self.set_user = set(list_users)

    def login_system(self, name, identifier):
        """
        Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð²Ñ…Ð¾Ð´Ð° Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ.

        :param name: Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ,
        :param identifier: id Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ,
        :return: ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð¸Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° LevelException
        """
        for item in self.set_user:
            if item.identifier == identifier and item.name == name:
                return item.level
        else:
            raise AccessException(name, identifier)

    def add_user(self, name, identifier, level):
        """
        Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾.

        :param name: Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ,
        :param identifier: id Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ,
        :param level: ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ,
        :return: ÐµÑÐ»Ð¸ Ñ‚Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÐµÑÑ‚ÑŒ Ð¸ ÐµÐ³Ð¾ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ð¾Ð²Ð¾Ð³Ð¾, Ñ‚Ð¾ Ð¾ÑˆÐ¸Ð±ÐºÐ° LevelException, Ð² Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð½Ð¾Ð¼ ÑÐ»ÑƒÑ‡Ð°Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ.
        """
        for item in self.set_user:
            if item.identifier == identifier and item.name == name:
                if int(item.level) > level:
                    raise LevelException(item.level, level)
        u = Us(name, identifier, level)
        set.add(self.set_user, u)


if __name__ == '__main__':
    d = User()
    d.load()
    d.add_user('Evgeny', 'uc', 7)
    print(d.login_system('Evgeny', 'uc'))
    print(d)
